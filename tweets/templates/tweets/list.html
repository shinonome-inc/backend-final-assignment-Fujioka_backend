{% extends 'tweets/base.html' %}

{% block header %}
{% include 'tweets/header.html' %}
{% endblock header %}


{% block content %}
{% if user.is_authenticated %}

<div class="container">
    <a href={% url 'tweets:create' %} class="text-decoration-none" tabindex="-1" role="button">
        <div class="fs-2 mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">
                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
            </svg>
            New Tweet
        </div>
    </a>
        {% for tweet in tweet_list %}
        <div class="alert alert-light  pt-0 pb-0" role='alert'>
            {% comment %} <a href={%url 'accounts:profile' tweet.author%} class="nav-link"> {% endcomment %}
            <a href='#' class="nav-link">
                <p class="fs-5 text-decoration-none">> {{tweet.author}}</p>
            </a>
            <a href="{%url 'tweets:detail' tweet.pk%}" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
               <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"/></svg>
                <span class="fs-6 pb-3">{{tweet.text}}</span>
            </a>

            <div class="like-outer">
                {% include 'tweets/like.html' %}
            </div>
            
            <hr/>
        </div>
    {% endfor %}
</div>

<script type='text/javascript'>
    $(document).ready(function(event) {
        $(document).on('click', '#like', function(event) {
            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: '{% url "tweets:like" %}',
                data: {
                    'tweet_pk': $(this).attr('name'),
                    'csrfmiddlewaretoken': '{{csrf_token}}'
                },
                dataType: 'json',
                success: function(response) {
                    selector = document.getElementsByName(response.tweet_pk);
                    if(response.liked) {
                        $(selector).html("<i class='fas fa-lg fa-heart like-red'></i>");
                    }
                    else {
                        $(selector).html("<i class='far fa-lg fa-heart'></i>");
                    }
                    console.log({{tweet.likemodel_set.count}}+ 'AAAAAAAAA')
                    selector2 = document.getElementsByName(response.tweet_pk+'-count');
                    $(selector2).text(response.count);
                }
            })
        })
    })
</script>
{% else %}
<a href="{% url 'login' %}">please login</a>
{% endif %}
{% endblock content %}
